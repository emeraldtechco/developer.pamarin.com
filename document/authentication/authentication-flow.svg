<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1207px" height="1874px" viewBox="-0.5 -0.5 1207 1874" content="&lt;mxfile modified=&quot;2019-08-09T03:57:00.452Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36&quot; etag=&quot;LV6tkR0WwpI8X1vxB1ax&quot; version=&quot;11.1.4&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;17bl3SH3Tnu5EkGAU0ez&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 148 161 L 148 1858.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 148 1863.88 L 144.5 1856.88 L 148 1858.63 L 151.5 1856.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 550 160 L 550 1858.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 550 1863.88 L 546.5 1856.88 L 550 1858.63 L 553.5 1856.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="490" y="120" width="120" height="40" fill="#dae8fc" stroke="#6c8ebf" pointer-events="none"/><g transform="translate(500.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="98" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 99px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">www.pamarin.com</div></div></foreignObject><text x="49" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">www.pamarin.com</text></switch></g><rect x="88" y="121" width="120" height="40" fill="#f5f5f5" stroke="#666666" pointer-events="none"/><g transform="translate(111.5,134.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="73" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; width: 73px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">User/Browser</div></div></foreignObject><text x="37" y="12" fill="#333333" text-anchor="middle" font-size="12px" font-family="Helvetica">User/Browser</text></switch></g><path d="M 1010 160 L 1010 1858.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 1010 1863.88 L 1006.5 1856.88 L 1010 1858.63 L 1013.5 1856.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="940" y="120" width="140" height="40" fill="#fff2cc" stroke="#d6b656" pointer-events="none"/><g transform="translate(955.5,133.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="109" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 110px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">authen.pamarin.com</div></div></foreignObject><text x="55" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">authen.pamarin.com</text></switch></g><path d="M 150 202 L 543.63 202" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 202 L 541.88 205.5 L 543.63 202 L 541.88 198.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 550 876 L 1003.63 876" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008.88 876 L 1001.88 879.5 L 1003.63 876 L 1001.88 872.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(573.5,189.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="201" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 202px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">2. นำ <font color="#0000ff">access_token</font> มา build http post <br />ส่งไปตรวจสอบที่ <font color="#0000ff">/oauth/session</font></div></div></foreignObject><text x="101" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(239.5,163.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="201" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 203px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">1. เข้าใช้งาน / ร้องขอ resource<br />cookie : <font color="#0000ff">access_token</font> / <font color="#0000ff">refresh_token</font></div></div></foreignObject><text x="101" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(564.5,848.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="237" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 238px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">8. redirect ไปที่  <font color="#0000ff">/oauth/authorize</font> (ต่อจาก 7.2)</div></div></foreignObject><text x="119" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">8. redirect ไปที่  &lt;font color="#0000ff"&gt;/oauth/authorize&lt;/font&gt; (ต่อจาก 7.2)</text></switch></g><g transform="translate(565.5,882.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="337" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 338px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">querystring : <font color="#0000ff">response_type=code</font>, <font color="#0000ff">client_id</font>, <font color="#0000ff">redirect_uri</font>, <font color="#0000ff">scope</font><br />random <font color="#0000ff">state=yyy </font>จัดเก็บไว้พร้อมแนบไปด้วย</div></div></foreignObject><text x="169" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(1024.5,253.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 180px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">3. verify <font color="#0000ff">access_token </font>&amp;<font color="#0000ff"> user_session </font>in data store (redis)</div></div></foreignObject><text x="90" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1010 955 L 156.37 955" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 955 L 158.12 951.5 L 156.37 955 L 158.12 958.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(561.5,967.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="247" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 247px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">10.1 ถ้า verify request ไม่ผ่าน จะได้ error กลับไปทาง redirect_uri?error=xxx</font></div></div></foreignObject><text x="124" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1008 1123 L 154.37 1123" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 149.12 1123 L 156.12 1119.5 L 154.37 1123 L 156.12 1126.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(562.5,1135.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="299" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 300px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">10.3 ถ้า verify ผ่าน <b><u>แต่</u></b> user ยังไม่ได้ทำการ login เข้าสู่ระบบ<br />จะได้หน้า <font color="#0000ff">/oauth/signin</font> กลับไป</div></div></foreignObject><text x="150" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(22.5,1829.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="97" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 98px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">วนกลับไปข้อ 1 ใหม่</div></div></foreignObject><text x="49" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">วนกลับไปข้อ 1 ใหม่</text></switch></g><path d="M 148 1200 L 1003.63 1200" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008.88 1200 L 1001.88 1203.5 L 1003.63 1200 L 1001.88 1196.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(7.5,1157.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="115" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 116px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">11. กรอก <br />username / password<br />(ต่อจาก 10.3)</div></div></foreignObject><text x="58" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(275.5,1171.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 139px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">12. กดปุ่ม login / เข้าสู่ระบบ</div></div></foreignObject><text x="69" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">12. กดปุ่ม login / เข้าสู่ระบบ</text></switch></g><g transform="translate(1034.5,1213.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="115" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 116px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">13. ตรวจสอบ <br /><font color="#0000ff">username</font> / <font color="#0000ff">password</font></div></div></foreignObject><text x="58" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1009 1269 L 155.37 1269" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 150.12 1269 L 157.12 1265.5 L 155.37 1269 L 157.12 1272.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(569.5,1298.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="288" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 288px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">14.2 ถ้า valid username / password <br />ระบบจะ generate authorization_code กลับไปทาง <font color="#0000ff">redirect_uri?code=xxx&amp;state=yyy</font></div></div></foreignObject><text x="144" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1009 1348 L 155.37 1348" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 150.12 1348 L 157.12 1344.5 L 155.37 1348 L 157.12 1351.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(594.5,1233.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="261" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 262px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">14.1 ถ้า invalid username or password <br />จะแสดงข้อความว่า username / password ไม่ถูกต้อง</font></div></div></foreignObject><text x="131" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 150 1421 L 543.63 1421" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 548.88 1421 L 541.88 1424.5 L 543.63 1421 L 541.88 1417.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(570.5,1711.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="288" height="55" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 288px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">19.2.1. จัดเก็บ <font color="#0000ff">access_token</font> / <font color="#0000ff">refresh_token</font> ไว้<br />(set-cookie) รวมทั้ง verify <font color="#0000ff">session_token</font> ด้วย public key และเช็คสิทธิ์ (authorities) ตามข้อมูล <font color="#0000ff">session_token</font> ที่ระบบ authen ส่งมาให้</div></div></foreignObject><text x="144" y="34" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(575.5,1381.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="334" height="112" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 334px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">16. อ่าน parameter <font color="#0000ff">code=xxx</font> + verify <font color="#0000ff">state=yyy</font> <br />ว่าผ่านหรือไม่ เพื่อป้องกัน CSRF<br /><br />จากนั้น build http post ด้วย parameters <br /><font color="#0000ff">client_id</font>, <font color="#0000ff">client_secret</font>, <font color="#0000ff">code</font>, <font color="#0000ff">grant_type=authorization_code<br /></font><span style="text-align: center"><br />ส่ง request ไปขอ </span><font color="#0000ff" style="text-align: center">access_token, refresh_token</font><span style="text-align: center"> + ข้อมูล </span><font color="#0000ff" style="text-align: center">session_token</font><span style="text-align: center"> </span><span style="text-align: center">ที่ </span><font color="#0000ff" style="text-align: center">/oauth/token</font><font color="#0000ff"><br /></font></div></div></foreignObject><text x="167" y="62" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 1508 L 1003.63 1508" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1008.88 1508 L 1001.88 1511.5 L 1003.63 1508 L 1001.88 1504.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1014.5,1540.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="170" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 170px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">18. verify request<br />ตรวจสอบ <font color="#0000ff">code</font>, <font color="#0000ff">client_id</font> / <font color="#0000ff">client_scret, user_session</font></div></div></foreignObject><text x="85" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1009 1589 L 556.37 1589" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 551.12 1589 L 558.12 1585.5 L 556.37 1589 L 558.12 1592.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(644.5,1615.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="275" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 276px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">19.2 กรณีที่ verify request ผ่าน<br />ระบบจะ generate <font color="#0000ff">access_token</font>, <font color="#0000ff">refresh_token</font> <br />ข้อมูล <font color="#0000ff">session_token</font> เป็น jwt กลับไปให้ในรูปแบบ json</div></div></foreignObject><text x="138" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1009 1669 L 556.37 1669" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 551.12 1669 L 558.12 1665.5 L 556.37 1669 L 558.12 1672.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(697.5,1547.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="170" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 172px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">19.1 กรณีที่ verify request ไม่ผ่าน<br />จะได้ error กลับไปในรูปแบบ json</font></div></div></foreignObject><text x="85" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(224.5,1386.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="250" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 252px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">15. browser get &amp; send <font color="#0000ff">code=xxx&amp;state=yyy</font> <br />ไปยัง www.pamarin.com (ต่อจาก 10.3 หรือ 14.2)</div></div></foreignObject><text x="125" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 1784 L 156.37 1784" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 1784 L 158.12 1780.5 L 156.37 1784 L 158.12 1787.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1023.5,896.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="178" height="55" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 178px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">9. verify request<br />ตรวจสอบ <font color="#0000ff">response_type</font>, <font color="#0000ff">client_id</font>, <font color="#0000ff">redirect_uri</font>,<br /><font color="#0000ff">scope </font>และเช็ค <font color="#0000ff">user_session</font> login</div></div></foreignObject><text x="89" y="34" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 233 L 1002.63 233" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1007.88 233 L 1000.88 236.5 L 1002.63 233 L 1000.88 229.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1010 302 L 558.37 302" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 553.12 302 L 560.12 298.5 L 558.37 302 L 560.12 305.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(570.5,491.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="263" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 264px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">5. นำ <font color="#0000ff">refresh_token</font> มา build http post (ต่อจาก 4.2)<br />เพื่อขอ <font color="#0000ff">access_token </font>ใหม่<br />ส่งไปที่ <font color="#0000ff">/oauth/token (</font><font color="#0000ff">grant_type=refresh_token)</font></div></div></foreignObject><text x="132" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(563.5,344.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="225" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 225px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">4.1.1 verify <font color="#0000ff">session_token</font> ด้วย public key จากนั้นเช็คสิทธิ์ (authorities) ตามข้อมูล <br /><font color="#0000ff">session_token</font> ที่ระบบ authen ส่งมาให้</div></div></foreignObject><text x="113" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 336.5 L 156.37 336.5" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 336.5 L 158.12 333 L 156.37 336.5 L 158.12 340 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(217.5,296.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="246" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 248px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">4.1.1.1 ถ้าไม่มีสิทธิ์เข้าถึง<br />จะ return error (access denied) กลับไปหา user </font></div></div></foreignObject><text x="123" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 400 L 156.37 400" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 400 L 158.12 396.5 L 156.37 400 L 158.12 403.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(254.5,362.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="176" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 177px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">4.1.1.2 ถ้ามีสิทธิ์เข้าถึง <br />จะ return resource กลับไปหา user</div></div></foreignObject><text x="88" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">4.1.1.2 ถ้ามีสิทธิ์เข้าถึง &lt;br&gt;จะ return resource กลับไปหา user</text></switch></g><path d="M 1010 457 L 558.37 457" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 553.12 457 L 560.12 453.5 L 558.37 457 L 560.12 460.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(649.5,415.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="244" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 246px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">4.2 ถ้า access_token หรือ user_session invalid<br />จะ return error กลับไปในรูปแบบ json</font></div></div></foreignObject><text x="122" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 555.5 L 1002.63 555.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1007.88 555.5 L 1000.88 559 L 1002.63 555.5 L 1000.88 552 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(623.5,259.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="292" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 293px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">4.1 ถ้า <font color="#0000ff">access_token</font> <b><u>และ</u></b> <font color="#0000ff">user_session</font> valid<br />จะ return <font color="#0000ff">session_token</font> เป็น jwt กลับมาให้ในรูปแบบ json</div></div></foreignObject><text x="146" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(1028.5,576.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="154" height="69" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 154px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">6. verify request<br />ตรวจสอบ <font color="#0000ff">refresh_token, user_session, client_id, client_secret<br /><br /></font></div></div></foreignObject><text x="77" y="41" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1011.5 638 L 559.87 638" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 554.62 638 L 561.62 634.5 L 559.87 638 L 561.62 641.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(570.5,579.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="353" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 354px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">7.1 ถ้า <font color="#0000ff">refresh_token </font><b><u>และ</u></b><font color="#0000ff"> user_session</font> valid<br />จะ return <font color="#0000ff">access_token, refresh_token </font>ใหม่ + ข้อมูล<font color="#0000ff"> session_token</font> <br />เป็น jwt กลับไปในรูปแบบ json</div></div></foreignObject><text x="177" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(564.5,680.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="321" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 321px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">7.1.1 จัดเก็บ <font color="#0000ff">access_token</font> + <font color="#0000ff">refresh_token</font> ใหม่ (set-cookie) รวมทั้ง verify <font color="#0000ff">session_token</font> ด้วย public key และเช็คสิทธิ์ตามข้อมูล <font color="#0000ff">session_token</font> ที่ระบบ authen ส่งมาให้</div></div></foreignObject><text x="161" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 680 L 156.37 680" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 680 L 158.12 676.5 L 156.37 680 L 158.12 683.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(261.5,1578.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="176" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 177px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">19.1.1 return error กลับไปหา user</font></div></div></foreignObject><text x="88" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">&lt;font color="#ff0000"&gt;19.1.1 return error กลับไปหา user&lt;/font&gt;</text></switch></g><path d="M 550 743.5 L 156.37 743.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 743.5 L 158.12 740 L 156.37 743.5 L 158.12 747 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(254.5,706.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="176" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 177px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">7.1.1.2 ถ้ามีสิทธิ์เข้าถึง <br />จะ return resource กลับไปหา user</div></div></foreignObject><text x="88" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">7.1.1.2 ถ้ามีสิทธิ์เข้าถึง &lt;br&gt;จะ return resource กลับไปหา user</text></switch></g><path d="M 1009 797.5 L 557.37 797.5" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 552.12 797.5 L 559.12 794 L 557.37 797.5 L 559.12 801 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(573.5,755.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="244" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 245px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">7.2 ถ้า refresh_token หรือ user_session invalid<br />จะ return error กลับไปในรูปแบบ json</font></div></div></foreignObject><text x="122" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 1610.5 L 156.37 1610.5" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 1610.5 L 158.12 1607 L 156.37 1610.5 L 158.12 1614 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(227.5,650.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="246" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 248px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">7.1.1.1 ถ้าไม่มีสิทธิ์เข้าถึง<br />จะ return error (access denied) กลับไปหา user </font></div></div></foreignObject><text x="123" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 550 1709 L 156.37 1709" fill="none" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><path d="M 151.12 1709 L 158.12 1705.5 L 156.37 1709 L 158.12 1712.5 Z" fill="#ff0000" stroke="#ff0000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(227.5,1671.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="246" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 248px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ff0000">19.2.1.1 ถ้าไม่มีสิทธิ์เข้าถึง<br />จะ return error (access denied) กลับไปหา user </font></div></div></foreignObject><text x="123" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(264.5,1742.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="176" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 177px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">19.2.1.2 ถ้ามีสิทธิ์เข้าถึง <br />จะ return resource กลับไปหา user</div></div></foreignObject><text x="88" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">19.2.1.2 ถ้ามีสิทธิ์เข้าถึง &lt;br&gt;จะ return resource กลับไปหา user</text></switch></g><rect x="1028" y="213" width="139" height="32" rx="4.8" ry="4.8" fill="#0000ff" stroke="none" pointer-events="none"/><g transform="translate(1058.5,222.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="77" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 78px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ffffff">/oauth/session</font></div></div></foreignObject><text x="39" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="1028" y="540.5" width="139" height="32" rx="4.8" ry="4.8" fill="#0000ff" stroke="none" pointer-events="none"/><g transform="translate(1064.5,550.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 67px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ffffff">/oauth/token</font></div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="1028" y="854" width="139" height="32" rx="4.8" ry="4.8" fill="#0000ff" stroke="none" pointer-events="none"/><g transform="translate(1054.5,863.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="86" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 87px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ffffff">/oauth/authorize</font></div></div></foreignObject><text x="43" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="1028" y="1498.5" width="139" height="32" rx="4.8" ry="4.8" fill="#0000ff" stroke="none" pointer-events="none"/><g transform="translate(1064.5,1508.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 67px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ffffff">/oauth/token</font></div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="1026.5" y="1170" width="139" height="32" rx="4.8" ry="4.8" fill="#009900" stroke="none" pointer-events="none"/><g transform="translate(1061.5,1179.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="68" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 69px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font color="#ffffff">/oauth/signin</font></div></div></foreignObject><text x="34" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(469.5,97.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="154" height="14" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 155px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><b><font style="font-size: 14px">Client/Resource Server</font></b></div></div></foreignObject><text x="77" y="13" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(93.5,98.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="111" height="14" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 112px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><b><font style="font-size: 14px">Resource Owner</font></b></div></div></foreignObject><text x="56" y="13" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(938.5,97.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="14" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 139px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><b><font style="font-size: 14px">Authorization Server</font></b></div></div></foreignObject><text x="69" y="13" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(788.5,1849.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="124" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 126px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><font style="font-size: 8px">Copyright Pamarin © 2019-Present</font></div></div></foreignObject><text x="62" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(453.5,-0.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="244" height="53" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 245px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><b style="font-size: 23px"><font style="font-size: 23px">OAuth 2.0 Framework <br />for Single Sign-On <br /></font></b></div></div></foreignObject><text x="122" y="33" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 1009 1035 L 155.37 1035" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 150.12 1035 L 157.12 1031.5 L 155.37 1035 L 157.12 1038.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(563.5,1047.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="288" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 288px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">10.2 ถ้า verify ผ่าน และ user ได้เคย login/signin ไปแล้ว <br /><span style="text-align: center">ระบบจะ generate authorization_code กลับไปทาง </span><font color="#0000ff" style="text-align: center">redirect_uri?code=xxx&amp;state=yyy</font><font color="#0000ff" style="text-align: center"><br /></font></div></div></foreignObject><text x="144" y="27" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(165.5,1048.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="90" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 90px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left">ไปต่อที่ข้อ 15 เลย</span></div></div></foreignObject><text x="45" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
